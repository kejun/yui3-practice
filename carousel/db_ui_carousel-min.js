YUI.add("db-ui-carousel",function(c){var e=c.ClassNameManager.getClassName,i=e("carousel","current"),j=e("carousel","btn","next"),k=e("carousel","btn","prev"),h=e("carousel","dis"),m=e("carousel","switchdot");function g(){g.superclass.constructor.apply(this,arguments)}c.mix(g,{NAME:"carousel",ATTRS:{currentIndex:{value:0},contentItems:null,switchNode:null,effect:{value:"easeOutStrong"},duration:{value:0.5},strings:{value:{next:"\u524d\u8fdb",back:"\u540e\u9000"}}},HTML_PARSER:{contentItems:function(a){return a.all(".bd ul")}},
TEMPL_CONTROL:'<div class="'+e("carousel","switch")+'"><span class="'+j+'"><a href="#" title="{NEXT_TITLE}" hidefocus="ture">&gt;</a></span><span class="'+k+'"><a class="'+h+'" href="#" title="{BACK_TITLE}" hidefocus="ture">&lt;</a></span><ul class="'+m+'">{ITEMS}</ul></div>'});c.extend(g,c.Widget,{initializer:function(){},destructor:function(){this.switchButtons[0]=null;this.itemsContainer=this.switchButtons[1]=null},renderUI:function(){this._uiCreateSwitch();var a=this.get("switchNode"),b=e("carousel",
"items"),d=this.get("contentItems"),f=this.get("contentBox").one(".bd");this.switchButtons=[a.one("."+j+" a"),a.one("."+k+" a")];this.itemsContainer=a=c.Node.create('<div class="'+b+'"></div>').append(d);this.stepUnit=b=f.get("region").width;f.appendChild(a.setStyle("width",b*d.size()+200+"px"))},bindUI:function(){this.after("currentIndexChange",this._afterCurrentIndexChange);this.switchButtons[0].on("click",c.bind(this._handleNextClick,this));this.switchButtons[1].on("click",c.bind(this._handlePrevClick,
this));this.get("switchNode").delegate("click",c.bind(this._handleDotClick,this),"li a")},syncUI:function(){this._updateSwitchDot();this._updateSwitchButton();this._show(this.get("currentIndex"))},_uiCreateSwitch:function(){var a=this.get("contentBox"),b=this.get("contentItems"),d=n=b.size(),f=[],l=this.get("strings"),o=a.one(".hd");b.addClass(e("carousel","item"));if(!this.get("switchNode")){for(;n--;)f.push('<li><a href="#">'+(d-n)+"</a></li>");b=c.Node.create(g.TEMPL_CONTROL.replace("{ITEMS}",
f.join("")).replace("{NEXT_TITLE}",l.next).replace("{BACK_TITLE}",l.back));this.set("switchNode",b);o?a.one(".hd").append(b):a.prepend(c.Node.create('<div class="hd"></div>').append(b));b.one("li").addClass(i)}},_show:function(a){a=-1*a*this.stepUnit+"px";a=new c.Anim({node:this.itemsContainer,to:{left:a},easing:c.Easing[this.get("effect")],duration:this.get("duration")});a.run()},_afterCurrentIndexChange:function(){this._updateSwitchButton();this._updateSwitchDot();this._show(this.get("currentIndex"))},
_updateSwitchButton:function(){var a=this.get("currentIndex");c.each(this.switchButtons,function(b){b.removeClass(h)});if(a===0)this.switchButtons[1].addClass(h);else a===this.get("contentItems").size()-1&&this.switchButtons[0].addClass(h)},_updateSwitchDot:function(){var a=this.get("switchNode").all("li"),b=this.get("currentIndex");a.removeClass(i);a.each(function(d,f){f===b&&d.addClass(i)})},_handleNextClick:function(a){var b=this.get("currentIndex"),d=this.get("contentItems").size();a.preventDefault();
this.set("currentIndex",b+1<d?b+1:d-1)},_handlePrevClick:function(a){var b=this.get("currentIndex");a.preventDefault();this.set("currentIndex",b-1<0?0:b-1)},_handleDotClick:function(a){a.preventDefault();this.set("currentIndex",(a.currentTarget.get("innerHTML")|0)-1)}});c.namespace("ui");c.ui.Carousel=g},"0.0.1",{requires:["db-ui-carousel-skin","widget","anim-base","anim-easing"]});
